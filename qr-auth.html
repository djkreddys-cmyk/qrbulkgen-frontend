<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Account — QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">

<header class="bg-white shadow sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between">
    <a href="index.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>
  </div>
</header>

<div class="flex-grow flex items-center justify-center px-4">
  <div class="bg-white w-full max-w-md rounded-2xl shadow-xl p-8">

<h2 id="title" class="text-2xl font-bold text-center mb-6">Create Account</h2>
<p id="msg" class="text-center text-sm mb-4"></p>

<input id="name" type="text" placeholder="Your Name" class="w-full border rounded-lg px-4 py-3 mb-3" />
<input id="email" type="email" placeholder="Email" class="w-full border rounded-lg px-4 py-3 mb-3" />
<input id="password" type="password" placeholder="Password" class="w-full border rounded-lg px-4 py-3 mb-3" />

<div id="forgotBox" class="text-right mb-3 hidden">
  <button id="forgotBtn" class="text-sm text-indigo-600 hover:underline">Forgot Password?</button>
</div>

<button id="mainBtn" class="w-full bg-indigo-600 text-white py-3 rounded-lg mb-4 hover:bg-indigo-700">Register</button>

<p class="text-center text-sm">
  <span id="switchText">Already registered?</span>
  <button id="switchBtn" class="text-indigo-600 font-semibold">Login</button>
</p>

  </div>
</div>

<!-- RESET PASSWORD MODAL -->

<div id="resetModal" class="fixed inset-0 bg-black/40 hidden items-center justify-center z-50">
  <div class="bg-white w-full max-w-sm rounded-2xl p-6 shadow-xl">
<h3 class="text-xl font-bold mb-4 text-center">Reset Password</h3>
<div class="relative mb-3">
  <input id="resetEmail" type="email" placeholder="Registered Email"
    class="w-full border rounded-lg px-4 py-3 pr-10" />
  <span id="emailStatus" class="absolute right-3 top-3 text-xl"></span>
</div>
<input id="resetPassword" type="password" placeholder="New Password"
  class="w-full border rounded-lg px-4 py-3 mb-4 opacity-50" disabled />
<button id="updatePasswordBtn"
  class="w-full bg-indigo-600 text-white py-3 rounded-lg mb-2">
  Update Password
</button>
<button id="cancelReset" class="w-full text-gray-500">
  Cancel
</button>
  </div>
</div>
<script>
const API="https://qrbulkgen-backend-production.up.railway.app/api";
let isLogin=false;
const nameEl=document.getElementById("name");
const emailEl=document.getElementById("email");
const passwordEl=document.getElementById("password");
const title=document.getElementById("title");
const mainBtn=document.getElementById("mainBtn");
const switchBtn=document.getElementById("switchBtn");
const switchText=document.getElementById("switchText");
const forgotBox=document.getElementById("forgotBox");
const msg=document.getElementById("msg");
function show(t,color="red"){
 msg.innerText=t;
 msg.className="text-center text-sm mb-4 text-"+color+"-600";
}
// ---------- SWITCH MODE ----------
switchBtn.onclick=()=>{
 isLogin=!isLogin;
 if(isLogin){
  title.innerText="Login";
  mainBtn.innerText="Login";
  nameEl.style.display="none";
  forgotBox.classList.remove("hidden");
  switchText.innerText="New here?";
  switchBtn.innerText="Register";
 }else{
  title.innerText="Create Account";
  mainBtn.innerText="Register";
  nameEl.style.display="block";
  forgotBox.classList.add("hidden");
  switchText.innerText="Already registered?";
  switchBtn.innerText="Login";
 }
};
// ---------- LOGIN / REGISTER ----------
mainBtn.onclick=async()=>{
 const email=emailEl.value.trim();
 const password=passwordEl.value.trim();
 if(isLogin){
   const r=await fetch(API+"/login",{
     method:"POST",
     headers:{'Content-Type':'application/json'},
     body:JSON.stringify({email,password})
   });
   if(r.status!==200){ show("Invalid login"); return; }
   const data=await r.json();
   localStorage.setItem("token",data.token);
   const after = localStorage.getItem("afterLogin");
   localStorage.removeItem("afterLogin");
   window.location = after || "qr-dashboard.html";
 }else{
   const name=nameEl.value.trim();
   if(!name||!email||!password){ show("Fill all fields"); return; }
   const r=await fetch(API+"/register",{
     method:"POST",
     headers:{'Content-Type':'application/json'},
     body:JSON.stringify({name,email,password})
   });
   show(await r.text(),"green");
 }
};
// ---------- OPEN MODAL ----------
document.getElementById("forgotBtn").onclick=()=>{
  document.getElementById("resetModal").classList.remove("hidden");
  document.getElementById("resetModal").classList.add("flex");
  document.getElementById("resetEmail").value=emailEl.value;
};
// ---------- CLOSE MODAL ----------
document.getElementById("cancelReset").onclick=()=>{
  document.getElementById("resetModal").classList.add("hidden");
  document.getElementById("resetModal").classList.remove("flex");
};
// ---------- CHECK EMAIL ----------
document.getElementById("resetEmail").addEventListener("input", async ()=>{
  const email=document.getElementById("resetEmail").value.trim();
  const status=document.getElementById("emailStatus");
  const pass=document.getElementById("resetPassword");
  if(email.length<5){
    status.innerHTML="";
    pass.disabled=true;
    pass.classList.add("opacity-50");
    return;
  }
  const r=await fetch(API+"/check-email",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({email})});
  const data=await r.json();
  if(data.exists){
    status.innerHTML="✔";
    status.className="absolute right-3 top-3 text-xl text-green-500";
    pass.disabled=false;
    pass.classList.remove("opacity-50");
  }else{
    status.innerHTML="✖";
    status.className="absolute right-3 top-3 text-xl text-red-500";
    pass.disabled=true;
    pass.classList.add("opacity-50");
  }
});
// ---------- UPDATE PASSWORD ----------
document.getElementById("updatePasswordBtn").onclick=async()=>{
  const email=document.getElementById("resetEmail").value.trim();
  const newPassword=document.getElementById("resetPassword").value.trim();
  if(!newPassword){ alert("Enter new password"); return; }
  const r=await fetch(API+"/reset-password",{method:"POST",headers:{'Content-Type':'application/json'},body:JSON.stringify({email,newPassword})});
  alert(await r.text());
  if(r.ok){
    document.getElementById("resetModal").classList.add("hidden");
    document.getElementById("resetModal").classList.remove("flex");
  }
};
</script>
</body>
</html>
