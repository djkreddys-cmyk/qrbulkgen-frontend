<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bulk QR Upload — QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="js/auth.js"></script>
<style>
.qrTab{padding:10px 14px;border-radius:10px;color:#374151;white-space:nowrap}
.qrTab:hover{background:#eef2ff;color:#4f46e5}
.qrTab.active{background:#4f46e5;color:white}
</style>
</head>
<body class="bg-gray-100">
<!-- NAVBAR -->
<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">

<a id="logoLink" href="qr-dashboard.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>

<div class="flex items-center gap-6">
<div id="navLinks" class="hidden md:flex gap-6">
<a href="qr-single.html">Generate QR</a>
<a href="qr-bulk.html" class="font-semibold text-indigo-600">Bulk Upload</a>
<a href="qr-dashboard.html">Dashboard</a>
</div>
<div id="navUser"></div>
</div>

</div>
</header>

<!-- TYPE SLIDER -->

<div class="bg-white border-b sticky top-[72px] z-40">
<div class="max-w-7xl mx-auto flex items-center px-2 whitespace-nowrap">

<button id="leftArrow" onclick="slideTabs(-1)" class="p-2 text-xl">◀</button>

<div id="tabsWrapper" class="overflow-hidden flex-1 min-w-0">
<div id="tabs" class="flex gap-4 py-3 transition-all duration-300 w-max">

<button class="qrTab active" onclick="selectType('text',this)">Text</button>
<button class="qrTab" onclick="selectType('url',this)">Website</button>
<button class="qrTab" onclick="selectType('whatsapp',this)">WhatsApp</button>
<button class="qrTab" onclick="selectType('wifi',this)">WiFi</button>
<button class="qrTab" onclick="selectType('upi',this)">UPI</button>
<button class="qrTab" onclick="selectType('email',this)">Email</button>
<button class="qrTab" onclick="selectType('phone',this)">Phone</button>
<button class="qrTab" onclick="selectType('location',this)">Location</button>
<button class="qrTab" onclick="selectType('vcard',this)">Business Card</button>
<button class="qrTab" onclick="selectType('menu',this)">Restaurant Menu</button>
<button class="qrTab" onclick="selectType('product',this)">Product Label</button>
<button class="qrTab" onclick="selectType('ticket',this)">Event Ticket</button>
</div>
</div>
<button id="rightArrow" onclick="slideTabs(1)" class="p-2 text-xl">▶</button>
</div>
</div>
</div>
<!-- CONTENT -->

<div class="max-w-7xl mx-auto p-6 grid md:grid-cols-2 gap-8">

<!-- LEFT PANEL -->

<div class="bg-white rounded-2xl shadow p-6">

<h2 id="bulkTitle" class="text-xl font-bold mb-6">Text QR Bulk Upload</h2>


<!-- ROW 1 -->
<div class="grid md:grid-cols-2 gap-6 mb-6">

<!-- STEP 1 -->
<div>
<h3 class="font-semibold mb-2">Step 1 — Download Sample</h3>
<button onclick="downloadSample()" class="bg-indigo-600 text-white px-5 py-2 rounded-xl w-full">
Download Sample Excel
</button>
</div>

<!-- STEP 2 -->
<div>
<h3 class="font-semibold mb-2">Step 2 — Upload Excel</h3>
<input type="file" id="excelFile" accept=".xlsx,.xls,.csv"
class="w-full border rounded-xl p-3">
<p id="fileName" class="text-sm text-gray-500 mt-2"></p>
</div>

</div>

<!-- ROW 2 -->
<div class="grid md:grid-cols-2 gap-6 mb-6">

<!-- STEP 3 LOGO -->
<div>
<h3 class="font-semibold mb-2">Step 3 — Logo (Optional)</h3>
<input type="file" id="bulkLogo" accept="image/*"
class="w-full border rounded-xl p-3">
</div>

<!-- STEP 4 LOAD -->
<div>
<h3 class="font-semibold mb-2">Step 4 — Load Data</h3>
<button onclick="processExcel()" class="bg-green-600 text-white px-6 py-3 rounded-xl w-full">
Load Excel Data
</button>
<p id="rowsInfo" class="text-sm text-gray-500 mt-2"></p>
</div>

</div>

<!-- QR CUSTOMIZATION -->
<div id="customizationArea"></div>

</div>
<!-- RIGHT PANEL -->

<div class="bg-white rounded-2xl shadow p-6">
<h2 class="text-xl font-semibold mb-4">Preview Data</h2>
<div id="bulkPreviewQR" class="mb-4 flex justify-center"></div>
<div id="previewTable" class="overflow-auto max-h-[450px] text-sm"></div>

<!-- BULK ACTION BUTTONS -->
<div class="grid grid-cols-2 gap-3 mt-4">

<button onclick="downloadBulkZip()"
class="bg-green-600 text-white py-3 rounded-xl w-full">
Download ZIP
</button>

<button onclick="saveBulkZip()"
class="bg-indigo-600 text-white py-3 rounded-xl w-full">
Save ZIP
</button>

</div>

</div>


</div>

<script>

let currentType="text";
let tabPosition=0;
let excelData=[];
let bulkLogoURL = null;

/* SLIDER */
function slideTabs(dir){
const wrapper=document.getElementById("tabsWrapper");
const tabs=document.getElementById("tabs");
const maxScroll=tabs.scrollWidth-wrapper.clientWidth;

tabPosition+=dir*200;
if(tabPosition<0)tabPosition=0;
if(tabPosition>maxScroll)tabPosition=maxScroll;

tabs.style.transform=`translateX(-${tabPosition}px)`;
}

/* SELECT TYPE */
function selectType(type,el){

currentType=type;
document.querySelectorAll(".qrTab").forEach(t=>t.classList.remove("active"));
el.classList.add("active");

/* update title */
const names={
text:"Text",
url:"Website",
whatsapp:"WhatsApp",
wifi:"WiFi",
upi:"UPI",
email:"Email",
phone:"Phone",
location:"Location",
vcard:"Business Card",
menu:"Menu",
product:"Product",
ticket:"Ticket"
};

document.getElementById("bulkTitle").innerText=
names[type]+" QR Bulk Upload";

}


/* FILE NAME */
document.getElementById("excelFile").addEventListener("change", e=>{
document.getElementById("fileName").innerText =
e.target.files[0] ? "Selected: "+e.target.files[0].name : "";
});
/* detect logo upload */
document.getElementById("bulkLogo").addEventListener("change", e=>{
const file = e.target.files[0];
bulkLogoURL = file ? URL.createObjectURL(file) : null;
updateBulkPreview();
});

/* SAMPLE DOWNLOAD */
function downloadSample(){
let headers=["data"];
switch(currentType){
case "text":
headers=["text"];
break;
case "url":
headers=["url"];
break;
case "whatsapp":
headers=["phone","message"];
break;
case "wifi":
headers=["ssid","password"];
break;
case "upi":
headers=["upi_id","amount"];
break;
case "email":
headers=["email","subject"];
break;
case "phone":
headers=["phone"];
break;
case "location":
headers=["address"];
break;
case "vcard":
headers=["name","company","phone"];
break;
case "menu":
headers=["menu_url"];
break;
case "product":
headers=["product_name","product_code"];
break;
case "ticket":
headers=["event","seat","date"];
break;
}
/* create excel */
const ws=XLSX.utils.aoa_to_sheet([headers]);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Sample");
XLSX.writeFile(wb, currentType+"_sample.xlsx");
}
/* PROCESS EXCEL */
function processExcel(){

const file=document.getElementById("excelFile").files[0];
if(!file){
alert("Please upload Excel first");
return;
}

const reader=new FileReader();

reader.onload=function(e){

const data=new Uint8Array(e.target.result);
const workbook=XLSX.read(data,{type:"array"});

const sheetName=workbook.SheetNames[0];
const sheet=workbook.Sheets[sheetName];

/* read rows including empty cells */
const rows=XLSX.utils.sheet_to_json(sheet,{header:1,defval:""});

if(rows.length<=1){
alert("Excel file has no data");
return;
}

/* convert to objects */
const headers=rows[0];
excelData=rows.slice(1).map(r=>{
let obj={};
headers.forEach((h,i)=>obj[h]=r[i]||"");
return obj;
});

document.getElementById("rowsInfo").innerText =
excelData.length+" rows loaded successfully";

renderPreview();
updateBulkPreview();

};

reader.readAsArrayBuffer(file);
}

function loadCustomizationUI(){
document.getElementById("customizationArea").innerHTML = `
<div class="border-t pt-5">

<h3 class="font-semibold mb-4">QR Customization</h3>

<div class="grid grid-cols-3 md:grid-cols-3 gap-4">

<div>
<label class="text-xs">QR Color</label>
<input type="color" id="qrColor" value="#000000" class="w-full h-10" onchange="updateBulkPreview()">
</div>

<div>
<label class="text-xs">Background</label>
<input type="color" id="bgColor" value="#ffffff" class="w-full h-10" onchange="updateBulkPreview()">
</div>

<div>
<label class="text-xs">Style</label>
<select id="qrStyle" class="w-full border rounded-lg h-10 px-2" onchange="updateBulkPreview()">
<option value="square">Square</option>
<option value="dots">Dots</option>
<option value="rounded">Rounded</option>
<option value="classy">Classy</option>
<option value="classy-rounded">Classy Rounded</option>
<option value="extra-rounded">Extra Rounded</option>
</select>
</div>

</div>
</div>
`;
}

/* PREVIEW TABLE */
function renderPreview(){
if(excelData.length===0)return;
let html="<table class='w-full border'>";
html+="<tr>";
Object.keys(excelData[0]).forEach(h=>{
html+=`<th class="border px-2 py-1 bg-gray-100">${h}</th>`;
});
html+="</tr>";
excelData.forEach(row=>{
html+="<tr>";
Object.values(row).forEach(v=>{
html+=`<td class="border px-2 py-1">${v??""}</td>`;
});
html+="</tr>";
});
html+="</table>";
document.getElementById("previewTable").innerHTML=html;
}
window.addEventListener("DOMContentLoaded", ()=>{
loadCustomizationUI();
});
let previewQR=null;

function updateBulkPreview(){

if(excelData.length===0) return;

const color=document.getElementById("qrColor").value;
const bg=document.getElementById("bgColor").value;
const style=document.getElementById("qrStyle").value;

let text=Object.values(excelData[0]).join(" ");

document.getElementById("bulkPreviewQR").innerHTML="";

previewQR=new QRCodeStyling({
width:220,
height:220,
data:text,
image:bulkLogoURL,

dotsOptions:{color:color,type:style},
cornersSquareOptions:{type:style,color:color},
cornersDotOptions:{type:style,color:color},

backgroundOptions:{color:bg},
imageOptions:{crossOrigin:"anonymous",margin:6}
});


previewQR.append(document.getElementById("bulkPreviewQR"));
}

async function generateBulkQRs(){

if(excelData.length===0){
alert("Load Excel first");
return null;
}

const color=document.getElementById("qrColor").value;
const bg=document.getElementById("bgColor").value;
const style=document.getElementById("qrStyle").value;

const zip=new JSZip();

for(let i=0;i<excelData.length;i++){

let text=Object.values(excelData[i]).join(" ");

const qr=new QRCodeStyling({
width:500,
height:500,
data:text,

image: bulkLogoURL,   // ← THIS makes logo appear

dotsOptions:{color:color,type:style},
cornersSquareOptions:{type:style,color:color},
cornersDotOptions:{type:style,color:color},
backgroundOptions:{color:bg},


imageOptions:{
crossOrigin:"anonymous",
margin:6
}
});

const blob=await qr.getRawData("png");
zip.file(`QR_${i+1}.png`,blob);
}

/* IMPORTANT: return zip */
return await zip.generateAsync({type:"blob"});
}

async function downloadBulkZip(){
const blob=await generateBulkQRs();
if(!blob) return;

const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="bulk_qr_codes.zip";
a.click();
}
async function saveBulkZip(){

const blob=await generateBulkQRs();
if(!blob) return;

const reader=new FileReader();

reader.onload=function(){

let saved=JSON.parse(localStorage.getItem("savedQRs")||"[]");

saved.push({
name:"Bulk QR "+new Date().toLocaleString(),
date:new Date().toLocaleString(),
data:reader.result,
type:"zip"
});

localStorage.setItem("savedQRs",JSON.stringify(saved));
alert("Bulk ZIP saved to Dashboard");

};

reader.readAsDataURL(blob);
}

</script>
</body>
</html>










