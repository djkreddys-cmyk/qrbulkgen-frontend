<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bulk QR Upload â€” QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="js/auth.js"></script>
</head>
<body class="bg-gray-100">

<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
<a href="qr-dashboard.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>
<div class="flex items-center gap-6">
<div class="hidden md:flex gap-6">
<a href="qr-single.html">Generate QR</a>
<a href="qr-bulk.html">Bulk Upload</a>
<a href="qr-dashboard.html">Dashboard</a>
</div>
<div id="navUser"></div>
</div>
</div>
</header>

<div class="max-w-4xl mx-auto p-6">
<div class="bg-white rounded-2xl shadow p-6">
<h2 class="text-2xl font-bold mb-4">Bulk QR Generator</h2>

<div class="grid md:grid-cols-2 gap-4">
<input type="file" id="excelFile" accept=".xlsx" class="border p-3 rounded-xl">
<input type="file" id="logoFile" accept="image/*" class="border p-3 rounded-xl">
</div>

<div class="flex gap-4 mt-4">
<button onclick="downloadSample()" class="bg-gray-800 text-white px-4 py-2 rounded-xl">Download Sample Excel</button>
<button onclick="processExcel()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl">Generate ZIP</button>
</div>

<div id="status" class="mt-4 text-sm text-gray-600"></div>
</div>
</div>

<script>
let logoURL=null;

document.getElementById('logoFile').addEventListener('change',e=>{
 const f=e.target.files[0];
 if(f) logoURL=URL.createObjectURL(f);
});

function downloadSample(){
 const data=[
  {type:'text',value:'Hello World',name:'sample1'},
  {type:'url',value:'https://google.com',name:'google'},
  {type:'phone',value:'9876543210',name:'call'}
 ];
 const ws=XLSX.utils.json_to_sheet(data);
 const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,'QR');
 XLSX.writeFile(wb,'qr_bulk_sample.xlsx');
}

async function processExcel(){
 const file=document.getElementById('excelFile').files[0];
 if(!file) return alert('Upload excel');
 document.getElementById('status').innerText='Reading Excel...';

 const buf=await file.arrayBuffer();
 const wb=XLSX.read(buf);
 const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

 const zip=new JSZip();
 let i=0;
 for(const r of rows){
  i++;
  document.getElementById('status').innerText=`Generating ${i}/${rows.length}`;

  let data=r.value||'';
  if(r.type==='phone') data=`tel:${data}`;
  if(r.type==='email') data=`mailto:${data}`;

  const qr=new QRCodeStyling({
   width:800,height:800,data:data,image:logoURL,
   dotsOptions:{color:'#000',type:'square'},
   backgroundOptions:{color:'#fff'}
  });

  const blob=await qr.getRawData('png');
  zip.file((r.name||'qr_'+i)+'.png',blob);
 }
 document.getElementById('status').innerText='Zipping...';
 const content=await zip.generateAsync({type:'blob'});
 saveAs(content,'QR_CODES.zip');
 document.getElementById('status').innerText='Done';
}
</script>
</body>
</html>
