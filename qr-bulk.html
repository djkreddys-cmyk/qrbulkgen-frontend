<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bulk QR Upload — QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="js/auth.js"></script>
<style>
.qrTab{padding:10px 14px;border-radius:10px;color:#374151;white-space:nowrap}
.qrTab:hover{background:#eef2ff;color:#4f46e5}
.qrTab.active{background:#4f46e5;color:white}
</style>
</head>
<body class="bg-gray-100">

<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
<a id="logoLink" href="qr-dashboard.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>
<div class="flex items-center gap-6">
<div id="navLinks" class="hidden md:flex gap-6">
<a href="qr-single.html">Generate QR</a>
<a href="qr-bulk.html">Bulk Upload</a>
<a href="qr-dashboard.html">Dashboard</a>
</div>
<div id="navUser"></div>
</div>
</div>
</header>

<!-- TYPE SLIDER -->
<div class="bg-white border-b sticky top-[72px] z-40">
<div class="max-w-7xl mx-auto flex items-center px-2">
<button id="leftArrow" onclick="slideTabs(-1)" class="p-2 text-xl">◀</button>
<div id="tabsWrapper" class="overflow-hidden flex-1">
<div id="tabs" class="flex gap-4 py-3 transition-all duration-300">
<button class="qrTab active" onclick="selectType('text',this)">Text</button>
<button class="qrTab" onclick="selectType('url',this)">Website</button>
<button class="qrTab" onclick="selectType('whatsapp',this)">WhatsApp</button>
<button class="qrTab" onclick="selectType('wifi',this)">WiFi</button>
<button class="qrTab" onclick="selectType('upi',this)">UPI</button>
<button class="qrTab" onclick="selectType('email',this)">Email</button>
<button class="qrTab" onclick="selectType('phone',this)">Phone</button>
<button class="qrTab" onclick="selectType('location',this)">Location</button>
<button class="qrTab" onclick="selectType('vcard',this)">Business Card</button>
<button class="qrTab" onclick="selectType('menu',this)">Restaurant Menu</button>
<button class="qrTab" onclick="selectType('product',this)">Product Label</button>
<button class="qrTab" onclick="selectType('ticket',this)">Event Ticket</button>
</div>
</div>
<button id="rightArrow" onclick="slideTabs(1)" class="p-2 text-xl">▶</button>
</div>
</div>

<div class="max-w-7xl mx-auto p-6 grid md:grid-cols-2 gap-8">

<!-- LEFT BOX -->
<div class="bg-white rounded-2xl shadow p-6">
<h2 class="text-xl font-semibold mb-4">Selected: <span id="selectedType">Text</span> QR</h2>

<div class="grid grid-cols-2 gap-4 mb-4">
<button onclick="downloadSample()" class="bg-gray-800 text-white px-4 py-2 rounded-xl">Step 1: Sample</button>
<input type="file" id="excelFile" accept=".xlsx" class="border p-2 rounded-xl">
</div>

<div class="grid grid-cols-2 gap-4 mb-4">
<input type="file" id="logoFile" accept="image/*" class="border p-2 rounded-xl">
<button onclick="loadPreview()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl">Load Data</button>
</div>

<hr class="my-4">
<h3 class="font-semibold mb-3">Customization</h3>
<div class="grid grid-cols-3 gap-3 items-end">
<input type="color" id="qrColor" value="#000000" class="h-10" oninput="updatePreview()">
<input type="color" id="bgColor" value="#ffffff" class="h-10" oninput="updatePreview()">
<select id="qrStyle" class="border rounded h-10 px-2" onchange="updatePreview()">
<option value="square">Square</option>
<option value="dots">Dots</option>
<option value="rounded">Rounded</option>
<option value="classy">Classy</option>
<option value="extra-rounded">Extra Rounded</option>
</select>
</div>
</div>

<!-- RIGHT BOX -->
<div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center">
<h2 class="text-xl font-semibold mb-4">Live Preview</h2>
<div id="preview" class="p-6 bg-white rounded-xl"></div>
<div class="grid grid-cols-2 gap-3 mt-6 w-full">
<button onclick="generateZip()" class="bg-green-600 text-white py-3 rounded-xl">Download ZIP</button>
<button onclick="saveDashboard()" class="bg-indigo-600 text-white py-3 rounded-xl">Save</button>
</div>
</div>
</div>

<script>
let currentType='text', rows=[], logoURL=null, qr;
function selectType(t,el){currentType=t;document.getElementById('selectedType').innerText=t.charAt(0).toUpperCase()+t.slice(1);document.querySelectorAll('.qrTab').forEach(b=>b.classList.remove('active'));el.classList.add('active');updatePreview();}
let tabPosition=0;function slideTabs(d){const w=tabsWrapper,t=tabs;const m=t.scrollWidth-w.clientWidth;tabPosition+=d*200;if(tabPosition<0)tabPosition=0;if(tabPosition>m)tabPosition=m;t.style.transform=`translateX(-${tabPosition}px)`;}
document.getElementById('logoFile').addEventListener('change',e=>{const f=e.target.files[0];if(f)logoURL=URL.createObjectURL(f);updatePreview();});
function downloadSample(){
let data=[]; let filename='qr_sample.xlsx';
switch(currentType){
case 'text': data=[{value:'Hello World',name:'text1'}]; filename='sample_text.xlsx'; break;
case 'url': data=[{value:'https://google.com',name:'web1'}]; filename='sample_website.xlsx'; break;
case 'phone': data=[{value:'9876543210',name:'call1'}]; filename='sample_phone.xlsx'; break;
case 'email': data=[{value:'demo@gmail.com',name:'mail1'}]; filename='sample_email.xlsx'; break;
case 'whatsapp': data=[{phone:'9876543210',msg:'Welcome',name:'wa1'}]; filename='sample_whatsapp.xlsx'; break;
case 'wifi': data=[{ssid:'OfficeNet',password:'12345678',name:'wifi1'}]; filename='sample_wifi.xlsx'; break;
case 'upi': data=[{upi:'shop@upi',amount:'100',name:'upi1'}]; filename='sample_upi.xlsx'; break;
case 'location': data=[{address:'Vijayawada',name:'loc1'}]; filename='sample_location.xlsx'; break;
case 'vcard': data=[{name:'Ramesh',org:'ABC Pvt Ltd',tel:'9999999999'}]; filename='sample_vcard.xlsx'; break;
case 'menu': data=[{url:'https://restaurantmenu.com',name:'menu1'}]; filename='sample_menu.xlsx'; break;
case 'product': data=[{product:'Rice Bag',code:'SKU123',name:'prod1'}]; filename='sample_product.xlsx'; break;
case 'ticket': data=[{event:'Music Fest',seat:'A12',date:'12-10-2026',name:'ticket1'}]; filename='sample_ticket.xlsx'; break;
}
const ws=XLSX.utils.json_to_sheet(data);
const wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,'QR');
XLSX.writeFile(wb,filename);
}];const ws=XLSX.utils.json_to_sheet(data);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,'QR');XLSX.writeFile(wb,'qr_bulk_sample.xlsx');}
async function loadPreview(){const file=excelFile.files[0];if(!file)return alert('Upload excel');const buf=await file.arrayBuffer();const wb=XLSX.read(buf);rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);updatePreview();}
function buildData(r){switch(currentType){case'url':return r.value;case'phone':return`tel:${r.value}`;case'email':return`mailto:${r.value}`;case'whatsapp':return`https://wa.me/${r.phone}?text=${encodeURIComponent(r.msg||'')}`;case'wifi':return`WIFI:T:WPA;S:${r.ssid};P:${r.password};;`;case'upi':return`upi://pay?pa=${r.upi}&am=${r.amount||''}`;case'location':return`https://www.openstreetmap.org/search?query=${encodeURIComponent(r.address||r.value)}`;case'vcard':return`BEGIN:VCARD\nVERSION:3.0\nFN:${r.name||''}\nORG:${r.org||''}\nTEL:${r.tel||''}\nEND:VCARD`;case'menu':return r.url||r.value;case'product':return`Product:${r.product}\nCode:${r.code}`;case'ticket':return`Event:${r.event}\nSeat:${r.seat}\nDate:${r.date}`;default:return r.value;}}
function updatePreview(){if(!rows.length)return;const r=rows[0];preview.innerHTML='';qr=new QRCodeStyling({width:260,height:260,data:buildData(r),image:logoURL,dotsOptions:{color:qrColor.value,type:qrStyle.value},backgroundOptions:{color:bgColor.value}});qr.append(preview);}
async function generateZip(){if(!rows.length)return alert('Load excel first');const zip=new JSZip();let i=0;for(const r of rows){i++;const q=new QRCodeStyling({width:800,height:800,data:buildData(r),image:logoURL,dotsOptions:{color:qrColor.value,type:qrStyle.value},backgroundOptions:{color:bgColor.value}});const blob=await q.getRawData('png');zip.file((r.name||'qr_'+i)+'.png',blob);}const content=await zip.generateAsync({type:'blob'});saveAs(content,'QR_CODES.zip');}
function saveDashboard(){if(!qr)return alert('Load preview first');qr.getRawData('png').then(blob=>{const r=new FileReader();r.onload=()=>{let saved=JSON.parse(localStorage.getItem('savedQRs')||'[]');saved.push({name:'BulkPreview',date:new Date().toLocaleString(),data:r.result});localStorage.setItem('savedQRs',JSON.stringify(saved));alert('Saved to dashboard');};r.readAsDataURL(blob);});}
</script>
</body>
</html>
