<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Bulk QR Upload — QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script src="js/auth.js"></script>

<style>
.qrTab{padding:10px 14px;border-radius:10px;color:#374151;white-space:nowrap}
.qrTab:hover{background:#eef2ff;color:#4f46e5}
.qrTab.active{background:#4f46e5;color:white}
</style>
</head>
<body class="bg-gray-100">

<!-- SAME NAVBAR (WITH LOGOUT SUPPORT) -->
<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
<a id="logoLink" href="qr-dashboard.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>
<div class="flex items-center gap-6">
<div id="navLinks" class="hidden md:flex gap-6">
<a href="qr-single.html">Generate QR</a>
<a href="qr-bulk.html">Bulk Upload</a>
<a href="qr-dashboard.html">Dashboard</a>
</div>
<div id="navUser"></div>
</div>
</div>
</header>

<!-- KEEP TYPE SLIDER UI (LEFT RIGHT ARROWS ANIMATION) -->
<div class="bg-white border-b sticky top-[72px] z-40">
<div class="max-w-7xl mx-auto flex items-center px-2">
<button id="leftArrow" onclick="slideTabs(-1)" class="p-2 text-xl">◀</button>
<div id="tabsWrapper" class="overflow-hidden flex-1">
<div id="tabs" class="flex gap-4 py-3 transition-all duration-300">
<button class="qrTab active">Text</button>
<button class="qrTab">Website</button>
<button class="qrTab">WhatsApp</button>
<button class="qrTab">WiFi</button>
<button class="qrTab">UPI</button>
<button class="qrTab">Email</button>
<button class="qrTab">Phone</button>
<button class="qrTab">Location</button>
<button class="qrTab">Business Card</button>
<button class="qrTab">Restaurant Menu</button>
<button class="qrTab">Product Label</button>
<button class="qrTab">Event Ticket</button>
</div>
</div>
<button id="rightArrow" onclick="slideTabs(1)" class="p-2 text-xl">▶</button>
</div>
</div>

<div class="max-w-4xl mx-auto p-6">
<div class="bg-white rounded-2xl shadow p-6">
<h2 class="text-2xl font-bold mb-4">Bulk QR Generator</h2>

<div class="grid md:grid-cols-2 gap-4">
<input type="file" id="excelFile" accept=".xlsx" class="border p-3 rounded-xl">
<input type="file" id="logoFile" accept="image/*" class="border p-3 rounded-xl">
</div>

<div class="flex gap-4 mt-4">
<button onclick="downloadSample()" class="bg-gray-800 text-white px-4 py-2 rounded-xl">Download Sample Excel</button>
<button onclick="processExcel()" class="bg-indigo-600 text-white px-4 py-2 rounded-xl">Generate ZIP</button>
</div>

<div id="status" class="mt-4 text-sm text-gray-600"></div>
</div>
</div>

<script>
let tabPosition=0;
function slideTabs(dir){
const wrapper=document.getElementById("tabsWrapper");
const tabs=document.getElementById("tabs");
const left=document.getElementById("leftArrow");
const right=document.getElementById("rightArrow");
const maxScroll=tabs.scrollWidth - wrapper.clientWidth;

tabPosition+=dir*200;
if(tabPosition<0) tabPosition=0;
if(tabPosition>maxScroll) tabPosition=maxScroll;

tabs.style.transform=`translateX(-${tabPosition}px)`;
left.style.visibility = tabPosition===0 ? "hidden":"visible";
right.style.visibility = tabPosition>=maxScroll ? "hidden":"visible";
}

let logoURL=null;
document.getElementById('logoFile').addEventListener('change',e=>{
 const f=e.target.files[0];
 if(f) logoURL=URL.createObjectURL(f);
});

function downloadSample(){
 const data=[
  {type:'text',value:'Hello World',name:'sample1'},
  {type:'url',value:'https://google.com',name:'google'},
  {type:'phone',value:'9876543210',name:'call'}
 ];
 const ws=XLSX.utils.json_to_sheet(data);
 const wb=XLSX.utils.book_new();
 XLSX.utils.book_append_sheet(wb,ws,'QR');
 XLSX.writeFile(wb,'qr_bulk_sample.xlsx');
}

async function processExcel(){
 const file=document.getElementById('excelFile').files[0];
 if(!file) return alert('Upload excel');
 document.getElementById('status').innerText='Reading Excel...';

 const buf=await file.arrayBuffer();
 const wb=XLSX.read(buf);
 const rows=XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);

 const zip=new JSZip();
 let i=0;
 for(const r of rows){
  i++;
  document.getElementById('status').innerText=`Generating ${i}/${rows.length}`;

  let data=r.value||'';
  if(r.type==='phone') data=`tel:${data}`;
  if(r.type==='email') data=`mailto:${data}`;

  const qr=new QRCodeStyling({
   width:800,height:800,data:data,image:logoURL,
   dotsOptions:{color:'#000',type:'square'},
   backgroundOptions:{color:'#fff'}
  });

  const blob=await qr.getRawData('png');
  zip.file((r.name||'qr_'+i)+'.png',blob);
 }
 document.getElementById('status').innerText='Zipping...';
 const content=await zip.generateAsync({type:'blob'});
 saveAs(content,'QR_CODES.zip');
 document.getElementById('status').innerText='Done';
}
</script>
</body>
</html>
