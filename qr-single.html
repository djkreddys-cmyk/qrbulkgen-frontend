<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Generate QR — QRBulkGen</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/qr-code-styling@1.6.0/lib/qr-code-styling.js"></script>
<script src="js/auth.js"></script>

<style>
.qrTab{padding:10px 14px;border-radius:10px;color:#374151;white-space:nowrap}
.qrTab:hover{background:#eef2ff;color:#4f46e5}
.qrTab.active{background:#4f46e5;color:white}
.btnGen{width:100%;background:#4f46e5;color:white;padding:12px;border-radius:12px}
</style>
</head>
<body class="bg-gray-100">

<!-- NAVBAR -->
<header class="bg-white shadow sticky top-0 z-50">
<div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">

<a id="logoLink" href="qr-dashboard.html" class="text-xl font-bold text-indigo-600">
QRBulkGen
</a>

<div class="flex items-center gap-6">
<div id="navLinks" class="hidden md:flex gap-6">
<a href="qr-single.html">Generate QR</a>
<a href="qr-bulk.html">Bulk Upload</a>
<a href="qr-dashboard.html">Dashboard</a>
</div>
<div id="navUser"></div>
</div>

</div>
</header>

<!-- TYPE SLIDER -->
<div class="bg-white border-b sticky top-[72px] z-40">
<div class="max-w-7xl mx-auto flex items-center px-2">

<button id="leftArrow" onclick="slideTabs(-1)" class="p-2 text-xl">◀</button>

<div id="tabsWrapper" class="overflow-hidden flex-1">
<div id="tabs" class="flex gap-4 py-3 transition-all duration-300">

<button class="qrTab active" onclick="selectType('text',this)">Text</button>
<button class="qrTab" onclick="selectType('url',this)">Website</button>
<button class="qrTab" onclick="selectType('whatsapp',this)">WhatsApp</button>
<button class="qrTab" onclick="selectType('wifi',this)">WiFi</button>
<button class="qrTab" onclick="selectType('upi',this)">UPI</button>
<button class="qrTab" onclick="selectType('email',this)">Email</button>
<button class="qrTab" onclick="selectType('phone',this)">Phone</button>
<button class="qrTab" onclick="selectType('location',this)">Location</button>
<button class="qrTab" onclick="selectType('vcard',this)">Business Card</button>
<button class="qrTab" onclick="selectType('menu',this)">Restaurant Menu</button>
<button class="qrTab" onclick="selectType('product',this)">Product Label</button>
<button class="qrTab" onclick="selectType('ticket',this)">Event Ticket</button>

</div>
</div>

<button id="rightArrow" onclick="slideTabs(1)" class="p-2 text-xl">▶</button>

</div>
</div>

<!-- CONTENT -->
<div class="max-w-7xl mx-auto p-6 grid md:grid-cols-2 gap-8">

<div id="formArea" class="bg-white rounded-2xl shadow p-6"></div>

<div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center w-full">
<h2 class="text-xl font-semibold mb-4">Live Preview</h2>

<div id="qrcode" class="p-6 bg-white rounded-xl"></div>
<button onclick="downloadQR()" class="mt-4 bg-green-600 text-white px-6 py-3 rounded-xl">
Download PNG
</button>
</div>
</div>

<script>
let currentType="text";
let qr;
let tabPosition=0;
/* remember customization */
let qrSettings={
color:"#000000",
bg:"#ffffff",
style:"square",
logo:null
};

/* ---------- SLIDER ---------- */
function slideTabs(dir){
const wrapper=document.getElementById("tabsWrapper");
const tabs=document.getElementById("tabs");
const left=document.getElementById("leftArrow");
const right=document.getElementById("rightArrow");

const maxScroll=tabs.scrollWidth - wrapper.clientWidth;

tabPosition+=dir*200;

if(tabPosition<0) tabPosition=0;
if(tabPosition>maxScroll) tabPosition=maxScroll;

tabs.style.transform=`translateX(-${tabPosition}px)`;

/* hide arrows */
left.style.visibility = tabPosition===0 ? "hidden":"visible";
right.style.visibility = tabPosition>=maxScroll ? "hidden":"visible";
}

/* ---------- TAB SWITCH ---------- */
function selectType(type,el){

/* reset customization when changing QR type */
qrSettings={
color:"#000000",
bg:"#ffffff",
style:"square",
logo:null
};

currentType=type;
document.querySelectorAll(".qrTab").forEach(t=>t.classList.remove("active"));
el.classList.add("active");
renderForm();
setTimeout(()=>slideTabs(0),200);

/* clear preview */
document.getElementById("qrcode").innerHTML="";
}

/* ---------- INPUT ---------- */
function input(id,placeholder){
return `<input id="${id}" placeholder="${placeholder}" class="w-full border rounded-xl p-3 mb-3" oninput="autoQR()">`;
}

/* ---------- FORM ---------- */
function renderForm(){
const a=document.getElementById("formArea");

const forms={
text:`<h2 class="text-xl font-bold mb-4">Text QR</h2>${input('data','Enter text')}`,
url:`<h2 class="text-xl font-bold mb-4">Website</h2>${input('data','https://example.com')}`,
whatsapp:`<h2 class="text-xl font-bold mb-4">WhatsApp</h2>${input('phone','Phone')}${input('msg','Message')}`,
wifi:`<h2 class="text-xl font-bold mb-4">WiFi</h2>${input('ssid','Network Name')}${input('pass','Password')}`,
upi:`<h2 class="text-xl font-bold mb-4">UPI</h2>${input('upi','UPI ID')}${input('amount','Amount')}`,
email:`<h2 class="text-xl font-bold mb-4">Email</h2>${input('mail','Email')}${input('subject','Subject')}`,
phone:`<h2 class="text-xl font-bold mb-4">Phone</h2>${input('call','Phone Number')}`,
location:`<h2 class="text-xl font-bold mb-4">Location</h2>${input('address','Enter shop / office / landmark')}`,
menu:`<h2 class="text-xl font-bold mb-4">Restaurant Menu</h2>${input('menuUrl','Menu URL')}`,
product:`<h2 class="text-xl font-bold mb-4">Product Label</h2>${input('productName','Product Name')}${input('productCode','SKU Code')}`,
ticket:`<h2 class="text-xl font-bold mb-4">Event Ticket</h2>${input('eventName','Event')}${input('seat','Seat')}${input('date','Date')}`,
vcard:`<h2 class="text-xl font-bold mb-4">Business Card</h2>${input('name','Name')}${input('org','Company')}${input('tel','Phone')}`
};

a.innerHTML=forms[currentType] + qrCustomizationUI();
}
function qrCustomizationUI(){
return `
<div class="border-t mt-4 pt-4">

<h3 class="font-semibold mb-3">QR Customization</h3>

<div class="grid grid-cols-2 md:grid-cols-5 gap-3 items-end">

<div>
<label class="text-xs">QR Color</label>
<input type="color" id="qrColor" value="${qrSettings.color}"
class="w-full h-10" oninput="updateQRSettings()">
</div>

<div>
<label class="text-xs">Background</label>
<input type="color" id="bgColor" value="${qrSettings.bg}"
class="w-full h-10" oninput="updateQRSettings()">
</div>

<div>
<label class="text-xs">Style</label>
<select id="qrStyle"
class="w-full border rounded-lg h-10 px-2"
onchange="updateQRSettings()">
<option value="square" ${qrSettings.style=="square"?"selected":""}>Square</option>
<option value="dots" ${qrSettings.style=="dots"?"selected":""}>Dots</option>
<option value="rounded" ${qrSettings.style=="rounded"?"selected":""}>Rounded</option>
<option value="classy" ${qrSettings.style=="classy"?"selected":""}>Classy</option>
<option value="classy-rounded" ${qrSettings.style=="classy-rounded"?"selected":""}>Classy Rounded</option>
<option value="extra-rounded" ${qrSettings.style=="extra-rounded"?"selected":""}>Extra Rounded</option>
</select>
</div>

<div>
<label class="text-xs">Logo</label>
<input type="file" id="logoUpload"
accept="image/*"
class="w-full text-xs"
onchange="updateQRSettings()">
</div>

<div>
<label class="text-xs invisible">Remove</label>
<button type="button" onclick="removeLogo()"
class="w-full h-10 text-red-500 border rounded-lg text-xs">
Remove
</button>
</div>

</div>
</div>
`;
}
/* ---------- SAFE VALUE ---------- */
function val(id){
const el=document.getElementById(id);
return el?el.value:"";
}

/* ---------- AUTO ---------- */
function autoQR(){ generateQR(); }

/* ---------- QR GENERATION ---------- */
function generateQR(){
let d="";

try{
switch(currentType){

case"whatsapp":
d=`https://wa.me/${val('phone')}?text=${encodeURIComponent(val('msg'))}`;
break;

case"wifi":
d=`WIFI:T:WPA;S:${val('ssid')};P:${val('pass')};;`;
break;

case"upi":
d=`upi://pay?pa=${val('upi')}&am=${val('amount')}`;
break;

case"email":
d=`mailto:${val('mail')}?subject=${val('subject')}`;
break;

case"phone":
d=`tel:${val('call')}`;
break;

/* LOCATION — only after 3 letters */
case"location":
const addr=val('address').trim();
if(addr.length<3){
document.getElementById("qrcode").innerHTML="";
return;
}
d=`https://www.openstreetmap.org/search?query=${encodeURIComponent(addr)}`;
break;

case"menu":
d=val('menuUrl');
break;

case"product":
d=`Product:${val('productName')}\nCode:${val('productCode')}`;
break;

case"ticket":
d=`Event:${val('eventName')}\nSeat:${val('seat')}\nDate:${val('date')}`;
break;

/* VCARD FIXED */
case"vcard":
const name=val('name');
const org=val('org');
const tel=val('tel');

if(!name && !org && !tel){
document.getElementById("qrcode").innerHTML="";
return;
}

d=`BEGIN:VCARD
VERSION:3.0
${name?`FN:${name}\n`:''}${org?`ORG:${org}\n`:''}${tel?`TEL:${tel}\n`:''}END:VCARD`;
break;

default:
d=val('data');
}

createQR(d);

}catch(e){
console.log("QR error:",e);
}
}

let qrCode;

function createQR(text){

if(!text){
document.getElementById("qrcode").innerHTML="";
return;
}

const color=qrSettings.color;
const bg=qrSettings.bg;
const style=qrSettings.style;
const logoURL=qrSettings.logo;

document.getElementById("qrcode").innerHTML="";

qrCode=new QRCodeStyling({
width:260,
height:260,
data:text,
image:logoURL,
dotsOptions:{
color:color,
type:style
},
backgroundOptions:{
color:bg
},
imageOptions:{
crossOrigin:"anonymous",
margin:5
}
});

qrCode.append(document.getElementById("qrcode"));
}
function updateQRSettings(){
qrSettings.color=document.getElementById("qrColor")?.value || "#000000";
qrSettings.bg=document.getElementById("bgColor")?.value || "#ffffff";
qrSettings.style=document.getElementById("qrStyle")?.value || "square";

const file=document.getElementById("logoUpload")?.files[0];
qrSettings.logo = file ? URL.createObjectURL(file) : null;

generateQR();
}
function removeLogo(){
qrSettings.logo=null;
const input=document.getElementById("logoUpload");
if(input) input.value="";
generateQR();
}


/* ---------- DOWNLOAD ---------- */
function downloadQR(){
if(!qrCode) return alert("Generate QR first");
qrCode.download({ name:"qr-code", extension:"png" });
}

renderForm();
</script>
<!-- NAVBAR AUTH CONTROLLER (VERY IMPORTANT) -->
<script src="js/auth.js"></script>
</body>
</html>









