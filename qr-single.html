<!DOCTYPE html>

<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Single QR Generator</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

</head>

<body class="bg-gray-100">

 <!-- NAVBAR -->
  <header class="bg-white shadow p-4 flex justify-between items-center sticky top-0 z-50">
  <a href="/index.html" class="text-xl font-bold text-indigo-600">QRBulkGen</a>

  <nav class="space-x-6 font-medium hidden md:flex items-center">
    <a href="/qr-single.html" class="hover:text-indigo-600">Generate QR</a>
    <a href="/qr-bulk.html" class="hover:text-indigo-600">Bulk Upload</a>
    <a href="/qr-dashboard.html" class="hover:text-indigo-600">Dashboard</a>
    <div id="navUser"></div>
  </nav>
</header>

<div class="max-w-7xl mx-auto p-6 grid md:grid-cols-2 gap-8">

  <!-- LEFT INPUT PANEL -->

  <div class="bg-white rounded-2xl shadow p-6">
    <h2 class="text-2xl font-bold mb-6">Create QR Code</h2>


<!-- Input -->
<input id="qrInput" type="text" placeholder="Enter URL or text"
  class="w-full border rounded-xl p-3 mb-6" />

<!-- Color -->
<div class="mb-6">
  <label class="block mb-2 font-medium">QR Color</label>
  <input id="color" type="color" value="#000000" />
</div>

<!-- Size -->
<div class="mb-6">
  <label class="block mb-2 font-medium">Size</label>
  <input id="size" type="range" min="150" max="400" value="250" />
</div>

<button onclick="generateQR()"
  class="mt-4 w-full bg-indigo-600 text-white py-3 rounded-xl">
  Generate QR
</button>


  </div>

  <!-- RIGHT PREVIEW PANEL -->

  <div class="bg-white rounded-2xl shadow p-6 flex flex-col items-center justify-center">
    <h2 class="text-xl font-semibold mb-6">Live Preview</h2>


<div id="qrcode" class="p-6 bg-white"></div>

<button onclick="downloadQR()"
  class="mt-6 bg-green-600 text-white px-6 py-3 rounded-xl">
  Download PNG
</button>

<button onclick="saveProject()"
  class="mt-3 bg-blue-600 text-white px-6 py-3 rounded-xl">
  Save Project
</button>


  </div>

</div>

<script>
const API="https://qrbulkgen-backend-production.up.railway.app/api";

let qr;
let lastQRData="";

// GENERATE QR
function generateQR(){
  const text=document.getElementById('qrInput').value || 'https://example.com';
  const color=document.getElementById('color').value;
  const size=document.getElementById('size').value;

  lastQRData=text;

  document.getElementById('qrcode').innerHTML='';
  qr=new QRCode(document.getElementById('qrcode'),{
    text:text,
    width:Number(size),
    height:Number(size),
    colorDark:color,
    colorLight:'#ffffff'
  });
}

// DOWNLOAD
function downloadQR(){
  const img=document.querySelector('#qrcode img');
  if(!img){
    alert("Generate QR first");
    return;
  }
  const link=document.createElement('a');
  link.href=img.src;
  link.download='qr-code.png';
  link.click();
}

// SAVE TO DATABASE
async function saveProject(){

  const token=localStorage.getItem("token");

  if(!token){
    alert("Please login first");
    location.href="qr-auth.html";
    return;
  }

  if(!lastQRData){
    alert("Generate QR first");
    return;
  }

  const name=prompt("Enter project name");
  if(!name)return;

  const r=await fetch(API+"/projects",{
    method:"POST",
    headers:{
      "Content-Type":"application/json",
      "Authorization":token
    },
    body:JSON.stringify({
      name:name,
      data:lastQRData
    })
  });

  if(r.status===200){
    alert("Saved to dashboard!");
  }else{
    alert("Error saving project");
  }
}

// REOPEN FROM DASHBOARD
window.onload=()=>{
  const data=localStorage.getItem("lastQR");
  if(data){
    document.getElementById('qrInput').value=data;
    generateQR();
    localStorage.removeItem("lastQR");
  }
};
</script>

</body>
</html>


